<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:FlipKit.Desktop.ViewModels"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="600"
             x:Class="FlipKit.Desktop.Views.RepriceView"
             x:DataType="vm:RepriceViewModel">

    <Grid RowDefinitions="Auto,*,Auto" Margin="24">

        <!-- Header -->
        <StackPanel Grid.Row="0" Margin="0,0,0,16">
            <TextBlock Text="Reprice Stale Cards" FontSize="24" FontWeight="Bold"/>
            <TextBlock IsVisible="{Binding HasCards}">
                <Run Text="{Binding TotalCount}"/>
                <Run Text="cards have prices older than threshold â€” Card"/>
                <Run Text="{Binding CurrentPosition}"/>
                <Run Text="of"/>
                <Run Text="{Binding TotalCount}"/>
            </TextBlock>
        </StackPanel>

        <!-- Main Content -->
        <ScrollViewer Grid.Row="1" IsVisible="{Binding HasCards}">
            <StackPanel Spacing="16" MaxWidth="700">

                <!-- Card Info -->
                <Border BorderBrush="{DynamicResource SystemBaseLowColor}" BorderThickness="1"
                        CornerRadius="8" Padding="20">
                    <Grid ColumnDefinitions="Auto,*" ColumnSpacing="16">
                        <Image Grid.Column="0" Source="{Binding CurrentCard.ImagePathFront}"
                               Width="80" MaxHeight="120" Stretch="Uniform"
                               VerticalAlignment="Top"
                               IsVisible="{Binding CurrentCard.ImagePathFront, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"/>
                        <StackPanel Grid.Column="1" Spacing="4">
                            <TextBlock Text="{Binding CurrentCard.PlayerName}" FontSize="20" FontWeight="Bold"/>
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <TextBlock Text="{Binding CurrentCard.Year}"/>
                                <TextBlock Text="{Binding CurrentCard.Manufacturer}"/>
                                <TextBlock Text="{Binding CurrentCard.Brand}"/>
                                <TextBlock Text="{Binding CurrentCard.ParallelName}" Opacity="0.7"/>
                            </StackPanel>
                        </StackPanel>
                    </Grid>
                </Border>

                <!-- Current Price Info -->
                <Border BorderBrush="Red" BorderThickness="1"
                        CornerRadius="8" Padding="20">
                    <StackPanel Spacing="8">
                        <TextBlock FontWeight="SemiBold" Foreground="Red">
                            <Run Text="Last priced:"/>
                            <Run Text="{Binding DaysSincePriced}"/>
                            <Run Text="days ago"/>
                        </TextBlock>
                        <TextBlock>
                            <Run Text="Current price:"/>
                            <Run Text="{Binding CurrentPrice, StringFormat='\{0:C2\}'}" FontWeight="Bold"/>
                        </TextBlock>
                    </StackPanel>
                </Border>

                <!-- Research Buttons -->
                <StackPanel Orientation="Horizontal" Spacing="8">
                    <Button Content="Open Terapeak" Command="{Binding OpenTerapeakCommand}" Padding="16,8"/>
                    <Button Content="Open eBay Sold" Command="{Binding OpenEbaySoldCommand}" Padding="16,8"/>
                </StackPanel>

                <!-- New Pricing Fields -->
                <Border BorderBrush="{DynamicResource SystemBaseLowColor}" BorderThickness="1"
                        CornerRadius="8" Padding="20">
                    <Grid ColumnDefinitions="*,*" RowDefinitions="Auto,Auto,Auto,Auto" RowSpacing="10" ColumnSpacing="16">
                        <TextBlock Grid.Row="0" Grid.Column="0" Text="New Market Value ($)" FontWeight="SemiBold"/>
                        <TextBox Grid.Row="0" Grid.Column="1" Text="{Binding NewMarketValue}" Watermark="e.g., 15.00"/>

                        <TextBlock Grid.Row="1" Grid.Column="0" Text="Suggested Price"/>
                        <TextBlock Grid.Row="1" Grid.Column="1" Text="{Binding SuggestedPrice, StringFormat='\{0:C2\}'}" FontWeight="SemiBold"/>

                        <TextBlock Grid.Row="2" Grid.Column="0" Text="New Listing Price ($)" FontWeight="SemiBold"/>
                        <TextBox Grid.Row="2" Grid.Column="1" Text="{Binding NewListingPrice}" Watermark="Your new price"/>

                        <TextBlock Grid.Row="3" Grid.Column="0" Text="Net After Fees"/>
                        <TextBlock Grid.Row="3" Grid.Column="1" Text="{Binding NetAfterFees, StringFormat='\{0:C2\}'}" Foreground="Green" FontWeight="SemiBold"/>
                    </Grid>
                </Border>
            </StackPanel>
        </ScrollViewer>

        <!-- No cards -->
        <TextBlock Grid.Row="1" Text="{Binding StatusMessage}"
                   IsVisible="{Binding !HasCards}"
                   HorizontalAlignment="Center" VerticalAlignment="Center"
                   FontSize="16" Opacity="0.5"/>

        <!-- Buttons -->
        <StackPanel Grid.Row="2" Orientation="Horizontal" Spacing="8"
                    Margin="0,16,0,0" IsVisible="{Binding HasCards}">
            <Button Content="Keep Current Price" Command="{Binding KeepCurrentPriceCommand}" Padding="16,8"/>
            <Button Content="Save New Price and Next" Command="{Binding SaveNewPriceCommand}"
                    Classes="accent" Padding="20,10"/>
            <Button Content="Skip" Command="{Binding SkipCommand}" Padding="16,8"/>
        </StackPanel>
    </Grid>
</UserControl>
